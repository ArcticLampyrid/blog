{"version":3,"sources":["kr-dark.js"],"names":["darkmodeCss","document","getElementById","darkModeStorageKey","getLS","k","localStorage","getItem","e","getModeFromCSSMediaQuery","window","matchMedia","matches","validColorModeKeys","dark","light","emitColorMode","mode","currentSetting","removeItem","removeLS","setAttribute","removeAttribute","invertDarkModeObj","toggleColorMode","v","setItem","setLS","addEventListener","event"],"mappings":"AAMA,MACI,MAAMA,EAAcC,SAASC,eAAe,gBACtCC,EAAqB,oBAyBrBC,EAASC,IACX,IACI,OAAOC,aAAaC,QAAQF,GAC9B,MAAOG,GAEL,OAAO,OAOTC,EAA2B,IACtBC,OAAOC,WAAW,gCAAgCC,QACnD,OACA,QAMJC,EAAqB,CACvBC,MAAQ,EACRC,OAAS,GAMPC,EAAiBC,IACnB,IAAIC,EAAiBD,GAAQb,EAAMD,GAKnC,OAJKU,EAAmBK,IAAmBA,IAAmBT,MAzCjD,CAACJ,IACd,IACIC,aAAaa,WAAWd,GAC1B,MAAOG,MAuCLY,CAASjB,GACTe,EAAiB,MAEbA,GACJ,IAAK,OACDlB,EAAYqB,aAAa,QAAS,OAClCrB,EAAYsB,gBAAgB,YAC5B,MACJ,IAAK,QACDtB,EAAYqB,aAAa,WAAY,YACrC,MACJ,QACIrB,EAAYqB,aAAa,QAAS,gCAClCrB,EAAYsB,gBAAgB,cAKlCC,EAAoB,CACtBT,KAAQ,QACRC,MAAS,QAMPS,EAAkB,KACpB,IAAIN,EAAiBd,EAAMD,GAO3B,OALIe,EADAL,EAAmBK,GACFK,EAAkBL,GAElBK,EAAkBd,KAnF7B,EAACJ,EAAGoB,KACd,IACInB,aAAaoB,QAAQrB,EAAGoB,GAC1B,MAAOjB,MAkFTmB,CAAMxB,EAAoBe,GACnBA,GAIXF,IAGAN,OAAOkB,iBAAiB,oBAAqBC,IACL5B,SAASC,eAAe,mBAChC0B,iBAAiB,SAAS,KAClDZ,EAAcQ,YAvG1B","file":"../js/kr-dark.min.js","sourcesContent":["/*\n * Reference: \n * - [你好黑暗，我的老朋友 —— 为网站添加用户友好的深色模式支持 by Sukka]\n *   (https://blog.skk.moe/post/hello-darkmode-my-old-friend/)\n */\n// 作为直接影响渲染的脚本，应该在最开始就加载，不应该defer\n(() => {\n    const darkmodeCss = document.getElementById('darkmode-css')\n    const darkModeStorageKey = 'user-color-scheme';\n\n    /**\n     * 设置 LocalStorage 的指定属性\n     */\n    const setLS = (k, v) => {\n        try {\n            localStorage.setItem(k, v);\n        } catch (e) {\n            // (此处不进行处理)\n        }\n    };\n    /**\n     * 移除 LocalStorage 的指定属性\n     */\n    const removeLS = (k) => {\n        try {\n            localStorage.removeItem(k);\n        } catch (e) {\n            // (此处不进行处理)\n        }\n    };\n    /**\n     * 获取 LocalStorage 的指定属性\n     */\n    const getLS = (k) => {\n        try {\n            return localStorage.getItem(k);\n        } catch (e) {\n            // 与 localStorage 中没有找到对应 key 的行为一致\n            return null;\n        }\n    };\n\n    /**\n     * 获取当前生效的显示模式（深色/浅色）名称\n     */\n    const getModeFromCSSMediaQuery = () => {\n        return window.matchMedia('(prefers-color-scheme: dark)').matches\n            ? 'dark'\n            : 'light'\n    };\n\n    /**\n     * 校验key\n     */\n    const validColorModeKeys = {\n        'dark': true,\n        'light': true\n    };\n\n    /**\n     * 提交指定的深色/浅色显示模式的设置\n     */\n    const emitColorMode = (mode) => {\n        var currentSetting = mode || getLS(darkModeStorageKey);\n        if (!validColorModeKeys[currentSetting] || currentSetting === getModeFromCSSMediaQuery()) {\n            removeLS(darkModeStorageKey); //reset\n            currentSetting = null;\n        }\n        switch (currentSetting) {\n            case \"dark\":\n                darkmodeCss.setAttribute('media', 'all');\n                darkmodeCss.removeAttribute('disabled');\n                break;\n            case \"light\":\n                darkmodeCss.setAttribute('disabled', 'disabled');\n                break;\n            default:\n                darkmodeCss.setAttribute('media', '(prefers-color-scheme: dark)');\n                darkmodeCss.removeAttribute('disabled');\n                break;\n        }\n    };\n\n    const invertDarkModeObj = {\n        'dark': 'light',\n        'light': 'dark'\n    };\n\n    /**\n     * 切换显示模式（深色/浅色）\n     */\n    const toggleColorMode = () => {\n        let currentSetting = getLS(darkModeStorageKey);\n        if (validColorModeKeys[currentSetting]) {\n            currentSetting = invertDarkModeObj[currentSetting];\n        } else {\n            currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];\n        }\n        setLS(darkModeStorageKey, currentSetting);\n        return currentSetting;\n    };\n\n    // 加载页面时即立刻提交一次\n    emitColorMode();\n\n    // DOM完成后才能监听按钮\n    window.addEventListener('DOMContentLoaded', (event) => {\n        const darkModeTogglebuttonElement = document.getElementById('darkmode-switch');\n        darkModeTogglebuttonElement.addEventListener('click', () => {\n            emitColorMode(toggleColorMode());\n        });\n    });\n})();\n"]}